<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Speech Synthesis</title>
  <link href='https://fonts.googleapis.com/css?family=Pacifico'
    rel='stylesheet'
    type='text/css'>
  <link rel="stylesheet"
    href="style.css">
</head>

<body>

  <div class="voiceinator">

    <h1>The Voiceinator 5000</h1>

    <select name="voice"
      id="voices">
      <option value="">Select A Voice</option>
    </select>

    <label for="rate">Rate:</label>
    <input name="rate"
      type="range"
      min="0"
      max="3"
      value="1"
      step="0.1">

    <label for="pitch">Pitch:</label>

    <input name="pitch"
      type="range"
      min="0"
      max="2"
      step="0.1">
    <textarea name="text">Hello! I love JavaScript ğŸ‘</textarea>
    <button id="stop">Stop!</button>
    <button id="speak">Speak</button>

  </div>

  <script>
    const msg = new SpeechSynthesisUtterance();
    let voices = [];
    const voicesDropdown = document.querySelector('[name="voice"]');
    const options = document.querySelectorAll('[type="range"], [name="text"]');
    const speakButton = document.querySelector('#speak');
    const stopButton = document.querySelector('#stop');
    //nameå±¬æ€§æ˜¯textçš„å…ƒç´ å–å‡ºå…§å®¹æ–‡å­—(value)ä¸¦è³¦å€¼åˆ°msgçš„text
    msg.text = document.querySelector('[name=text]').value;

    function populateVoices() {
      //å–å¾—è²éŸ³æ¨¡çµ„
      voices = this.getVoices();
      // console.log(voices);
      //å°æ‰€æœ‰è²éŸ³æ¨¡çµ„åŠ ä¸Š<option> 
      const voicesOption = voices
        //å°‡å°æ‡‰è‹±æ–‡éæ¿¾å‡ºä¾†
        .filter(voice => voice.lang.includes('en'))
        .map(voice => `<option value="${voice.name}">${voice.name}(${voice.value})</option>`)
        .join('');
      voicesDropdown.innerHTML = voicesOption;
    }

    //å–å¾—åå­—èˆ‡è²éŸ³å°æ‡‰ä¸¦å¯åŸ·è¡Œæ’­æ”¾
    function setVoice() {
      //è¨­å®šmsgçš„è²éŸ³ç‚ºå°æ‡‰çš„åå­—
      msg.voice = voices.find(voice => voice.name === this.value);
      toggle();
    }

    //é—œé–‰å’Œé–‹å•Ÿè²éŸ³
    function toggle(startOver = true) {
      speechSynthesis.cancel();
      if (startOver) {
        speechSynthesis.speak(msg);
      }
    }

    function setOption() {
      // console.log(this.name, this.value);
      //ç•¶ç§»å‹•å°æ‡‰çš„æ‹‰æ¡¿,å°‡å±¬æ€§è¨­å®šåˆ°msgèˆ‡å°æ‡‰æ•¸å€¼
      msg[this.name] = this.value;
    }
    //ç•¶èªéŸ³å°è±¡æ”¹è®Šæ™‚æœƒè§¸ç™¼
    speechSynthesis.addEventListener('voiceschanged', populateVoices);
    //ç•¶è¡¨å–®æ›´æ”¹æ™‚è§¸ç™¼setVoice
    voicesDropdown.addEventListener('change', setVoice);
    //ç•¶è¡¨å–®æ›´æ”¹æ™‚è§¸ç™¼setOption
    options.forEach(option => option.addEventListener('change', setOption));
    speakButton.addEventListener('click', toggle);
    stopButton.addEventListener('click', () => toggle(false));


  </script>

</body>

</html>